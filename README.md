# FreeIPA
## Немного теории:
С IdM: ИТ-администратор может:
* Храните идентификационные данные в одном центральном месте: сервер IdM
* Одновременное применение политик к нескольким машинам
* Установите различные уровни доступа для пользователей, используя управление доступом на основе хоста, делегирование и другие правила
* Централизованное управление правилами привилегий
* Монтирование домашних каталогов
  
Большинство сервисов не должны быть установлены на сервере IdM. Например, такие службы, как центр сертификации (CA), сервер DNS или сервер протокола сетевого времени (NTP), могут быть установлены на другом сервере за пределами домена IdM.
Клиент IdM не требует, чтобы выделенное клиентское программное обеспечение взаимодействовало как часть домена. Требуется только правильная конфигурация системы определенных служб и библиотек, таких как Kerberos или DNS. Эта конфигурация указывает клиентскому компьютеру использовать службы IdM.
Системный демон служб безопасности (SSSD) - это клиентское приложение для кэширования учетных данных. Рекомендуется использовать SSSD на клиентских компьютерах, поскольку это упрощает требуемую настройку клиента. SSSD также предоставляет дополнительные функции, например:
* Проверка подлинности клиента в автономном режиме обеспечивается кэшированием учетных данных из централизованных хранилищ удостоверений и аутентификации находящиеся локально на клиенте
* Улучшена согласованность процесса аутентификации, поскольку нет необходимости поддерживать как центральную учетную запись, так и локальную учетную запись пользователя для автономной аутентификации
* Интеграция с другими сервисами, такими как sudo
* Авторизация на основе хост-контроля доступа (HBAC)
  
Из соображений производительности и стабильности Red Hat рекомендует не устанавливать другие приложения или службы на серверы IdM. Например, серверы IdM могут быть исчерпывающими для системы, особенно если число объектов LDAP велико. Кроме того, IdM интегрирован в систему, и, если сторонние приложения изменяют конфигурационные файлы, от которых зависит IdM, IdM может сломаться.
  
При установке сервера IdM системные файлы перезаписываются для настройки домена IdM. IdM создает резервные копии исходных системных файлов в /var/lib/ipa/sysrestore/.
### Требования
Оперативная память - это самая важная аппаратная функция для правильного размера Чтобы определить, сколько оперативной памяти вам требуется, рассмотрите следующие рекомендации:
* Для 10 000 пользователей и 100 групп: не менее 3 ГБ ОЗУ и 1 ГБ подкачки
* Для 100 000 пользователей и 50 000 групп: не менее 16 ГБ ОЗУ и 4 ГБ пространства подкачки
## Подготовка
* Red Hat рекомендует отключить NSCD на компьютерах Identity Management. В качестве альтернативы, если отключение NSCD невозможно, включайте NSCD только для карт, которые SSSD не кэширует:
```Change the /etc/nscd.conf file:
enable-cache hosts yes
enable-cache passwd no
enable-cache group no
enable-cache netgroup no
enable-cache services no 
```
* IPv6 Должен быть включен в системе
* Полное доменное имя должно быть действительным DNS-именем, что означает, что допускаются только цифры, буквенные символы и дефисы (-). Другие символы, такие как подчеркивание, в имени хоста вызывают сбои DNS. Кроме того, имя хоста должно быть в нижнем регистре; заглавные буквы не допускаются. Полное доменное имя не должно преобразовываться в адрес обратной связи. Он должен соответствовать общедоступному IP-адресу машины, а не 127.0.0.1. К примеру /etc/hosts:
```
127.0.0.1	localhost.localdomain	localhost
::1		localhost6.localdomain6	localhost6
192.0.2.1	server.example.com	server
2001:DB8::1111	server.example.com	server
```
* Список Портов для окрытия в firewalld:
Service	    Ports	                Protocol
HTTP/HTTPS	80, 443	              TCP
LDAP/LDAPS	389, 636	            TCP
Kerberos	  88, 464	              TCP and UDP
DNS	        53	                  TCP and UDP
NTP	        123	                  UDP
* Список сервисов для окрытия в firewalld
Table 2.2. firewalld Services
Service name	For details, see:
freeipa-ldap	/usr/lib/firewalld/services/freeipa-ldap.xml
freeipa-ldaps	/usr/lib/firewalld/services/freeipa-ldaps.xml
dns	          /usr/lib/firewalld/services/dns.xml
  
!!! Red Hat настоятельно рекомендует использовать DNS, интегрированный с IdM, для базового использования в развертывании IdM: когда сервер IdM управляет DNS, существует тесная интеграция между DNS и собственными инструментами IdM, что позволяет автоматизировать некоторые функции управления записями DNS. При использовании встроенного DNS-сервера большая часть ведения DNS-записи автоматизируется. Необходимо только: настроить правильное делегирование из родительского домена на серверы IdM. При использовании внешнего DNS-сервера необходимо: вручную создать новый домен на DNS-сервере, вручную заполнить новый домен записями из файла зоны, обновлять записи вручную после установки или удаления реплики, а также после любых изменений в конфигурации службы IdM, например после настройки доверия Active Directory
### Установка Freeipa
* Открываем Порты:
```
firewall-cmd --permanent --add-port={53,80,88,135,138,139,389,443,445,464,636,1024-1300,3268}/tcp
firewall-cmd --permanent --add-port={53,88,123,138,139,389,445,464}/udp
firewall-cmd --reload
```
* Приводим /etc/resolv.conf к виду:
```
search example.com
nameserver 192.0.2.1
```
* Устанавливаем нужные пакеты 
```yum -y install bind bind-utils bind-dyndb-ldap ipa-server ipa-server-dns
```
* Перед началом установки, требуется попроваить конфигурационный файл DNS сервера:
    
    
